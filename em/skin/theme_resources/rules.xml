<rules
    xmlns="http://namespaces.plone.org/diazo"
    xmlns:css="http://namespaces.plone.org/diazo/css"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <!-- Apply theme to normal Plone pages -->
    <theme href="index.html" css:if-content="body.template-featured_videos_homepage" />
    
    <theme href="video.html" css:if-content="body.template-video_view" />

    <theme href="text.html" />
    
    <!-- ALL PAGES -->
    <rules>
        <!-- Drop Plone's meta tags that define the content type and IE rendering mode.
             We set those explicitly in our theme. This allows us to copy the
             rest of the <meta> tags in one go. -->

        <!-- Drop the viewport meta tag from Plone -->
        <drop css:content="meta[name=viewport]"/>
        <before content="/html/head/meta" css:theme="#css" />
        <replace content="/html/head/title" theme="/html/head/title"/>

        <!-- Copy the <base> tag -->
        <copy attributes="href" content="/html/head/base" theme="/html/head/base" />

        <!-- copy body attrs -->
        <prepend theme="/html/body" content="/html/body/@class" />
        <prepend theme="/html/body" content="/html/body/@id" />
        <prepend theme="/html/body" content="/html/body/@dir" />

        <!-- Copy style and link tags in the order they appear in the content -->
        <after
            content="/html/head/style | /html/head/link"
            css:theme="#css"
            />

        <!-- Drop the "type" attribute from <script> tags. HTML5 doesn't mandate
             it and we can save a few bytes there. -->
        <drop css:content="script" attributes="type"/>

        <!-- Copy script tags in the order they appear in the content but place
             them at the bottom of the theme. -->
        <before
            css:content="head > script"
            css:theme="#javascript_at_bottom"
            />

        <!-- Copy inline javascripts from within the body -->
        <!-- reCaptcha needs to stay within the body because they generate html
             in place where the JS is. -->
        <replace
            content="//body//script[not(contains(@src, 'www.google.com/recaptcha/api/challenge'))]"
            css:theme="#javascript_inline"
            method="raw"
            />

        <!-- Drop the scripts within the body because we have copied them to the
             end of the page -->
        <drop content="//div[@id='visual-portal-wrapper']//script[not(contains(@src, 'www.google.com/recaptcha/api/challenge'))]"/>

        <!-- Drop the javascript target from the theme -->
        <drop css:theme="#javascript_at_bottom"/>

        <!-- Copy over the id/class attributes on the body tag.
             This is important for per-section styling -->
        <merge attributes="class" css:content="body" css:theme="body" />
        <copy attributes="id dir" css:content="body" css:theme="body" />

        <!-- HEADER -->
        <copy css:content="#portal-searchbox" css:theme="div.search" />

        <!-- FOOTER -->
        
        <!-- Content footer is for siteelement doormat, so update this rule if
             doormat is needed for the theme -->
        <drop css:theme="#content-footer" />       
        <copy css:content-children=".siteelement-footertext .footertext" css:theme="#colophon" />
        <replace content='/html/body/div/div[2]/div[2]/div/dl/dd/ul' theme='/html/body/div[4]/div[2]/div[2]/ul' />
    </rules>

    <!-- HOMEPAGE -->
    <rules css:if-content="body.template-featured_videos_homepage">
        <replace theme="//*[@id='featuredvideo']/div[1]" css:content="dl#featured-video video"/>
        <!-- the right portlet column should contain News, Blog, Comments for this to work-->
        <!-- News -->
        <replace content="//*[@id='portal-column-two']/div/div[1]/dl[1]/dt[1]/a" theme="//h4[@id='news-title']" />
        <replace css:theme="#news-right-portlet">
        <ul id="news-right-portlet">
           <xsl:for-each select="//*[@id='portal-column-two']/div/div[1]/dl[1]/dd">
               <li><xsl:copy-of select="a" /> <br /> <xsl:value-of select="a/@title"/>               
               </li>
           </xsl:for-each>
        </ul>
        </replace>

        <!-- Blogs -->
        <replace content="//*[@id='portal-column-two']/div/div[2]/dl[1]/dt/a" theme="//h4[@id='blogs-title']" />
        <replace css:theme="#blogs-right-portlet">
        <ul id="blogs-right-portlet">
           <xsl:for-each select="//*[@id='portal-column-two']/div/div[2]/dl[1]/dd">
               <li><xsl:copy-of select="a" /> <br /> <xsl:value-of select="a/@title"/>
               </li>
           </xsl:for-each>
        </ul>
        </replace>

        <!-- Comments -->
        <replace content="//*[@id='portal-column-two']/div/div[3]/dl[1]/dt/a" theme="//h4[@id='comments-title']" />
        <replace css:theme="#comments-right-portlet">
        <ul id="comments-right-portlet">
           <xsl:for-each select="//*[@id='portal-column-two']/div/div[3]/dl[1]/dd">
               <li><xsl:copy-of select="a" /> <br /> <xsl:value-of select="a/@title"/>
               </li>
           </xsl:for-each>
        </ul>
        </replace>

        <!-- Featured items. Right portlets 4 and 5 -->
        <replace css:theme=".featured-filmmaker">
          <div class="featured-filmmaker">
              <xsl:copy-of select="//*[@id='portal-column-two']/div/div[4]/dl[1]/dd"/>
          </div>
        </replace>

        <replace css:theme=".featured-filmmaker">
          <div class="featured-filmmaker">
              <xsl:copy-of select="//*[@id='portal-column-two']/div/div[4]/dl[1]/dd"/>
          </div>
        </replace>

       <replace css:theme=".featured-content">
          <div class="featured-content">
              <xsl:copy-of select="//*[@id='portal-column-two']/div/div[5]/dl[1]/dd"/>
          </div>
        </replace>

        <replace css:theme="#mid-container #latestvideos">
            <div class="row content">
            <xsl:for-each css:select="#featured-latest-videos dd.featuredItem">
                <div class="three columns video">
                        <xsl:copy-of css:select="a.featured-video-image"/>
                    <div class="under"><h5><xsl:copy-of css:select="h4 a.featuredItemTitle"/></h5></div>
                </div>
            </xsl:for-each>
            </div>
        </replace>        
    </rules>
    
    <!-- VIDEO VIEW PAGE -->
    <rules css:if-content="body.template-video_view">
        
    </rules>
    
    <rules css:if-content="#visual-portal-wrapper">
        <copy css:content="#content-core" css:theme="div.text-content" />
    </rules> 
    
</rules>
