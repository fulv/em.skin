<rules
    xmlns="http://namespaces.plone.org/diazo"
    xmlns:css="http://namespaces.plone.org/diazo/css"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <!-- Apply theme to normal Plone pages -->
    <theme href="index.html" css:if-content="body.template-featured_videos_homepage" />
    
    <theme href="video.html" css:if-content="body.template-video_view" />

    <theme href="text.html" />
    
    <!-- ALL PAGES -->
    <rules>

        <!-- Drop the viewport meta tag from Plone -->
        <drop css:content="meta[name=viewport]"/>
        
        <!-- Copy all meta tags -->
        <before content="/html/head/meta" css:theme="#css" />
        
        <!-- Get page title -->
        <replace content="/html/head/title" theme="/html/head/title"/>

        <!-- Copy the <base> tag -->
        <copy content="/html/head/base" theme="/html/head/base" />

        <!-- copy body attrs -->
        <prepend theme="/html/body" content="/html/body/@class" />
        <prepend theme="/html/body" content="/html/body/@id" />
        <prepend theme="/html/body" content="/html/body/@dir" />

        <!-- Copy style and link tags in the order they appear in the content -->
        <after content="/html/head/style | /html/head/link" css:theme="#css" />

        <!-- Drop the "type" attribute from <script> tags. HTML5 doesn't mandate
             it and we can save a few bytes there. -->
        <drop css:content="script" attributes="type"/>

        <!-- Copy script tags in the order they appear in the content but place
             them at the bottom of the theme. -->
        <before
            css:content="head > script"
            css:theme="#javascript_at_bottom"
            />

        <!-- Copy inline javascripts from within the body -->
        <!-- reCaptcha needs to stay within the body because they generate html
             in place where the JS is. -->
        <replace
            content="//body//script[not(contains(@src, 'www.google.com/recaptcha/api/challenge'))]"
            css:theme="#javascript_inline"
            method="raw"
            />

        <!-- Drop the scripts within the body because we have copied them to the
             end of the page -->
        <drop content="//div[@id='visual-portal-wrapper']//script[not(contains(@src, 'www.google.com/recaptcha/api/challenge'))]"/>

        <!-- Drop the javascript target from the theme -->
        <drop css:theme="#javascript_at_bottom"/>

        <!-- Copy over the id/class attributes on the body tag.
             This is important for per-section styling -->
        <merge attributes="class" css:content="body" css:theme="body" />
        <copy attributes="id dir" css:content="body" css:theme="body" />


        <!-- HEADER -->
        
        <!-- Copy search box -->
        <copy css:content="#portal-searchbox" css:theme="div.search" />
        
        <!-- copy user menu -->
        <rules css:if-content="a#user-name">
            <copy css:content-children="dl#portal-personaltools dd.actionMenuContent > ul" css:theme="#user-menu ul.dropdown" />
            <copy css:content-children="a#user-name" css:theme="li.header-button > a.user" />
        </rules>
        <rules css:if-content="ul#portal-personaltools > li#anon-personalbar">
            <copy css:content="a#personaltools-login" css:theme="ul#user-menu" />
            <drop css:theme="#user-menu ul.dropdown" />
        </rules>

        <!-- copy language selector -->
        <copy css:content-children="ul#portal-languageselector li.currentLanguage" css:theme="ul#language-menu > li a" />
        <copy css:content-children="ul#portal-languageselector" css:theme="#language-menu ul.dropdown" />


        <!-- FOOTER ?? -->
        
        <!-- Content footer is for siteelement doormat, so update this rule if
             doormat is needed for the theme -->
        <drop css:theme="#content-footer" />       
        <copy css:content-children=".siteelement-footertext .footertext" css:theme="#colophon" />
        <replace content='/html/body/div/div[2]/div[2]/div/dl/dd/ul' theme='/html/body/div[4]/div[2]/div[2]/ul' />
    </rules>


    <!-- HOMEPAGE -->
    <rules css:if-content="body.template-featured_videos_homepage">
        <replace theme="//*[@id='featuredvideo']/div[1]" css:content="dl#featured-video video"/>
        <!-- the right portlet column should contain News, Blog, Comments for this to work-->
        <!-- News -->
        <replace content="//*[@id='portal-column-two']/div/div[1]/dl[1]/dt[1]/a" theme="//h4[@id='news-title']" />
        <replace css:theme="#news-right-portlet">
        <ul id="news-right-portlet">
           <xsl:for-each select="//*[@id='portal-column-two']/div/div[1]/dl[1]/dd">
               <li><xsl:copy-of select="a" /> <br /> <xsl:value-of select="a/@title"/>               
               </li>
           </xsl:for-each>
        </ul>
        </replace>

        <!-- Blogs -->
        <replace content="//*[@id='portal-column-two']/div/div[2]/dl[1]/dt/a" theme="//h4[@id='blogs-title']" />
        <replace css:theme="#blogs-right-portlet">
        <ul id="blogs-right-portlet">
           <xsl:for-each select="//*[@id='portal-column-two']/div/div[2]/dl[1]/dd">
               <li><xsl:copy-of select="a" /> <br /> <xsl:value-of select="a/@title"/>
               </li>
           </xsl:for-each>
        </ul>
        </replace>

        <!-- Comments -->
        <replace content="//*[@id='portal-column-two']/div/div[3]/dl[1]/dt/a" theme="//h4[@id='comments-title']" />
        <replace css:theme="#comments-right-portlet">
        <ul id="comments-right-portlet">
           <xsl:for-each select="//*[@id='portal-column-two']/div/div[3]/dl[1]/dd">
               <li><xsl:copy-of select="a" /> <br /> <xsl:value-of select="a/@title"/>
               </li>
           </xsl:for-each>
        </ul>
        </replace>

        <!-- Featured items. Right portlets 4 and 5 -->
        <replace css:theme=".featured-filmmaker">
          <div class="featured-filmmaker">
              <xsl:copy-of select="//*[@id='portal-column-two']/div/div[4]/dl[1]/dd"/>
          </div>
        </replace>

        <replace css:theme=".featured-filmmaker">
          <div class="featured-filmmaker">
              <xsl:copy-of select="//*[@id='portal-column-two']/div/div[4]/dl[1]/dd"/>
          </div>
        </replace>

       <replace css:theme=".featured-content">
          <div class="featured-content">
              <xsl:copy-of select="//*[@id='portal-column-two']/div/div[5]/dl[1]/dd"/>
          </div>
        </replace>

        <replace css:theme="#mid-container #latestvideos">
            <div class="row content">
            <xsl:for-each css:select="#featured-latest-videos dd.featuredItem">
                <div class="three columns video">
                        <xsl:copy-of css:select="a.featured-video-image"/>
                    <div class="under"><h5><xsl:copy-of css:select="h4 a.featuredItemTitle"/></h5></div>
                </div>
            </xsl:for-each>
            </div>
        </replace>        
    </rules>
    
    <!-- VIDEO VIEW PAGE -->
    <rules css:if-content="body.template-video_view">
        

        <copy css:content="#content h1.documentFirstHeading > span" css:theme="#video-title h1" /> 
        <copy css:theme=".video" css:content="#video-core" /> 
        <copy css:theme="#description" css:content="#content p.documentDescription" /> 
        <copy css:theme="#video-info" css:content="#video-infos" /> 
        <append css:theme="#video-info" css:content="#video-licensing" /> 
        <append css:theme="#video-info" css:content="#video-transcoding" /> 
        <copy css:theme="#video-comments" css:content=".discussion" /> 
        <append css:theme="#video-comments" css:content="#commenting" /> 
    
        <replace css:theme=".video-list">
            <ul class="video-list">
            <xsl:for-each css:select="#authors_latest li">
                <li class="video-item">
                        <a href="h4 a.video-download">
                        <!-- <xsl:copy-of select="h4 a.video-download" /><xsl:value-of select="a/@href"/> -->
                        <xsl:copy-of css:select="h4 img" />
                        <h5>
                            <xsl:copy-of css:select="h4 span.featuredItemTitle"/>
                        </h5>
                        <!-- <img class="video-thumb"> -->
                        </a>
                </li>
            </xsl:for-each>
            </ul>
        </replace>

    </rules>
    
    <rules css:if-content="#visual-portal-wrapper">
        <copy css:content="#portal-column-content" css:theme="#post-content > div.text-content" /> 
        <drop css:content="#portal-breadcrumbs" />
        <drop css:content="span.documentModified > span" />
    </rules> 
    
</rules>
